---
import { Image } from "astro:assets";
import facility1 from "../assets/facilities/IMG_8134.webp";
import facility2 from "../assets/facilities/IMG_8142.webp";
import facility3 from "../assets/facilities/IMG_8133.webp";
import facility4 from "../assets/facilities/IMG_7498.webp";
import facility5 from "../assets/facilities/IMG_6794.webp";
import facility6 from "../assets/facilities/IMG_5174.webp";


const facilities = [
  {
    src: facility1,
    alt: "Zona de peso libre y musculación de alta gama",
    title: "Zona de Fuerza"
  },
  {
    src: facility2,
    alt: "Pista de césped artificial para entrenamiento funcional",
    title: "Indoor Turf"
  },
  {
    src: facility3,
    alt: "Estructura de calistenia y barras olímpicas",
    title: "Zona Calistenia"
  },
  {
    src: facility4,
    alt: "Espacio dedicado a la recuperación y fisioterapia",
    title: "Recovery"
  },
  {
    src: facility5,
    alt: "Vestuarios premium con taquillas inteligentes",
    title: "Vestuarios"
  },
  {
    src: facility6,
    alt: "Área de entrenamiento funcional con equipos de última generación",
    title: "Functional Training"
  }
];
---

<section id="instalaciones" class="py-8 sm:py-12 lg:py-16 2xl:py-20 bg-zinc-900 text-white overflow-hidden" aria-labelledby="facilities-title">
  <div class="max-w-350 2xl:max-w-screen-2xl mx-auto px-4 sm:px-6">
    
    <header class="text-center max-w-3xl mx-auto mb-12 sm:mb-20">
      <h2 id="facilities-title" class="text-brand-green text-xs sm:text-sm font-black uppercase mb-3 sm:mb-4">
        Nuestras Instalaciones
      </h2>
      <p class="text-2xl sm:text-4xl md:text-5xl 2xl:text-6xl font-black text-white uppercase mb-4 sm:mb-6 tracking-tighter">
        ESPACIOS DE ALTO RENDIMIENTO
      </p>
      <p class="text-zinc-400 text-sm sm:text-lg 2xl:text-xl font-medium leading-relaxed max-w-2xl mx-auto">
        Más de 1000m² equipados con la última tecnología deportiva para maximizar tu desarrollo.
      </p>
    </header>

    <!-- Carousel Wrapper -->
    <div class="relative group">
      
      <!-- Scroll Container -->
      <div 
        id="facilities-carousel"
        class="flex gap-4 sm:gap-6 overflow-x-auto snap-x snap-mandatory scrollbar-hide pb-8 -mx-4 px-4 sm:mx-0 sm:px-0"
      >
        {facilities.map((item, index) => (
          <div class="snap-center shrink-0 w-[85vw] sm:w-100 lg:w-125 2xl:w-150 relative flex flex-col group/card">
            <div class="relative aspect-4/3 overflow-hidden rounded-2xl sm:rounded-3xl border border-white/10 bg-zinc-800 shadow-2xl">
              <Image 
                src={item.src} 
                alt={item.alt}
                class="w-full h-full object-cover transition-transform duration-700 group-hover/card:scale-110"
                width={800}
                height={600}
              />
              <!-- Overlay Gradient -->
              <div class="absolute inset-0 bg-linear-to-t from-black/90 via-black/20 to-transparent opacity-80"></div>
              
              <!-- Content -->
              <div class="absolute bottom-0 left-0 p-5 sm:p-8 w-full">
                <div class="w-10 h-1 bg-brand-green mb-3 sm:mb-4 rounded-full"></div>
                <h3 class="text-xl sm:text-2xl font-black uppercase tracking-wide text-white mb-1 sm:mb-2">
                  {item.title}
                </h3>
                <p class="text-zinc-400 text-xs sm:text-sm font-medium line-clamp-2">
                  {item.alt}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Navigation Buttons (Desktop) -->
      <button 
        id="prev-btn"
        class="absolute top-1/2 -left-4 lg:-left-10 xl:-left-4 2xl:-left-15 -translate-y-1/2 w-10 h-10 sm:w-14 sm:h-14 bg-brand-green text-white rounded-full items-center justify-center shadow-lg hover:bg-white hover:text-zinc-900 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0 disabled:cursor-not-allowed hidden sm:flex z-20 translate-x-4 group-hover:translate-x-0"
        aria-label="Ver imagen anterior"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-5 h-5 sm:w-6 sm:h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
      </button>

      <button 
        id="next-btn"
        class="absolute top-1/2 -right-4 lg:-right-6 xl:-right-4 2xl:-right-15 -translate-y-1/2 w-10 h-10 sm:w-14 sm:h-14 bg-brand-green text-white rounded-full items-center justify-center shadow-lg hover:bg-white hover:text-zinc-900 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0 disabled:cursor-not-allowed hidden sm:flex z-20 -translate-x-4 group-hover:translate-x-0"
        aria-label="Ver imagen siguiente"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-5 h-5 sm:w-6 sm:h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
      </button>
    </div>

    <div class="flex sm:hidden justify-center gap-2 mt-4">
      {facilities.map((_, i) => (
        <div class="w-1.5 h-1.5 rounded-full bg-zinc-800 transition-all duration-300 data-[active=true]:bg-brand-green data-[active=true]:w-4 indicator-dot" data-index={i}></div>
      ))}
    </div>

  </div>
</section>

<style>
  .scrollbar-hide::-webkit-scrollbar {
      display: none;
  }
  .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
  }
</style>

<script>
  const container = document.getElementById('facilities-carousel');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const dots = document.querySelectorAll('.indicator-dot');

  if (container) {
    const updateState = () => {
      if (dots.length) {
        const cardWidth = container.firstElementChild?.clientWidth || 0;
        const gap = 16;
        const scrollPos = container.scrollLeft;
        const index = Math.round(scrollPos / (cardWidth + gap));
        
        dots.forEach((dot, i) => {
          if (i === index) dot.setAttribute('data-active', 'true');
          else dot.setAttribute('data-active', 'false');
        });
      }
    };

    container.addEventListener('scroll', updateState);
    
    if(dots.length > 0) dots[0].setAttribute('data-active', 'true');

    if (prevBtn && nextBtn) {
      prevBtn.addEventListener('click', () => {
        const cardWidth = container.firstElementChild?.clientWidth || 300;
        container.scrollBy({ left: -(cardWidth + 16), behavior: 'smooth' });
      });

      nextBtn.addEventListener('click', () => {
        const cardWidth = container.firstElementChild?.clientWidth || 300;
        container.scrollBy({ left: (cardWidth + 16), behavior: 'smooth' });
      });
    }
  }
</script>